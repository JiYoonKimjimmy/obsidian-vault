# 🎯 대량 포인트 지급 시스템 요구 사항

## 📌 Overview

> [!info] 프로젝트 목적
> 주문사(무신사)에서 페이먼츠의 머니를 사용하여 결제한 회원들을 대상으로 포인트를 지급하기 위한 **대량 포인트 지급 시스템** 구축

### 핵심 요구 사항 요약

| 항목           | 내용                   |
| ------------ | -------------------- |
| **최대 지급 대상** | 100만(1M) 회원          |
| **처리 시간 목표** | 10 ~ 20분             |
| **데이터 일관성**  | Eventual Consistency |
| **캠페인 동시성**  | 순차 처리 (선착순 우선)       |

---

## ✅ 기능적 요구 사항

|  #  | 요구 사항     | 설명                         |
| :-: | --------- | -------------------------- |
|  1  | 포인트 지급    | 식별된 지급 대상자 목록 기준 머니 포인트 지급 |
|  2  | 지급 사유 관리  | row별 지급 사유(reason) 기록      |
|  3  | 지급 금액 관리  | row별 다른 지급 금액 설정 가능        |
|  4  | 재처리 프로세스  | 지급 실패 건 재처리 기능             |
|  5  | 중복 지급 방지  | 신규/재지급 시 멱등성 보장            |
|  6  | 다중 캠페인 지원 | 동일 회원이 여러 캠페인 참여 가능        |

---

## ⚡ 비기능적 요구 사항

### 성능 목표

```
┌─────────────────────────────────────────────────────────┐
│  📊 Performance Targets                                  │
├─────────────────────────────────────────────────────────┤
│  • 처리 대상: 1,000,000+ rows                            │
│  • 처리 시간: 10min ~ 20min                              │
│  • Money 시스템 TPS: 1,000+ (Rate-Limiter 적용)          │
└─────────────────────────────────────────────────────────┘
```

### 설계 범위

> [!note] 설계 포함
> - 캠페인별 대용량 포인트 지급 데이터 모델링
> - 고성능 처리 아키텍처
> - `money` 시스템 API 호출 추상화

> [!warning] 설계 제외
> - 대용량 회원 데이터 수집 프로세스 (이미 DB 적재 완료 가정)

---

## 🔄 재처리 정책

### 재시도 설정

| 항목        | 값              |
| --------- | -------------- |
| 최대 재시도 횟수 | **5회**         |
| 재시도 간격    | **Backoff 3초** |
| 트리거 방식    | 자동화 재처리 요청 필요  |

### 핵심 보장 항목
- **멱등성**: 중복 지급 요청 방지
- **재처리**: 실패 건 재처리 메커니즘
- **상태 체크**: 캠페인 상태가 `진행`이 아니면 지급 차단
- **동적 스케일링 전략**: 동적으로 대용량 처리 시스템을 스케일-인/아웃 할 수 있는 전략 필요
	- 100만건 이하: 프로세스/파티션 4개
	- 100만 ~ 200만건: 프로세스/파티션 6개
	- 200만건 이상 : 프로세스/파티션 8개
