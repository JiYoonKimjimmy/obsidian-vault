
## 레거시 시스템 비즈니스 로직

1. SFTP 전문 수신하여 가맹점 데이터 저장 처리 
	1. `가맹점번호` 기준 KB 가맹점 DB 조회
		1. 기존 정보 있는 경우, 정보 변경
		2. 기존 정보 없는 경우, 신규 등록
	2. `KB_MERCHANT` 테이블 DB 저장
	3. `KB_MERCHANT_HISTORY` 테이블 DB 저장
2. `MERCHANT_CHANGE_NOTICE` 테이블 DB 저장
3. 가맹점 주소 기준 `KAS` 좌표 정보 조회하여 데이터 저장 처리
4. 가맹점 저장 처리 후 `LBMS` 가맹점 등록 요청 처리

## 시스템 개선 단계 정리

1. `LBMS` API 요청 Event 발행 로직 수정
	1. 단건 Event 발행 > Chunk 단위 다건 Event 발행
2. `KB_MERCHANT`, `KB_MERCHANT_HISTORY` 테이블 DB 저장 로직 수정
	1. 각각 Entity 단건 저장 처리
	2. 각각 Entity List 다건 저장 처리
3. 기존 `KB_MERCHANT` 정보 단건 조회 > 업데이트 진행 로직 수정
	1. `KB_MERCHANT.MCT_MNG_NO` 기준 1000 건 다건 조회하여 DB 커넥션 처리 건수 감소
	2. 뚜렷한 성능 측면 효과 미비
4. Spring Batch Partitioning 적용하여 Step 병렬 처리
5. `Step2` 진행한 개선 사항 `IN` 절 조회 성능 개선
	1. `IN` 절 조회보다 단건 조회가 더 좋은 성능 측정
6. Spring Batch Partitioning 안정화
	1. 전문 연동 데이터 기준 Partition 분류 처리 안정화
	2. 전문 연동 데이터 건수 비례한 Thread-Pool 관리

### 단계별 성능 변화

- `DEV1` 서버 `10000` 건 데이터 처리 기준 성능 측정

|  단계   | 성능(ms) |
| :---: | :----: |
| step0 | 43115  |
| step1 | 41659  |
| step2 | 36531  |
| step3 | 40662  |
| step4 | 16105  |
| step5 | 10870  |
### 최종 성능 측정

- `DEV1` 서버 기준 `100000` 건 데이터 처리 기준 성능 측정

|  단계   | 성능(ms) |
| :---: | :----: |
| step0 | 432292 |
| step6 | 27875  |
