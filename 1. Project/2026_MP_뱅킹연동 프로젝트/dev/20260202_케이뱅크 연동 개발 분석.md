- 개발 설계 문서: https://musinsapayments.atlassian.net/wiki/x/BACfAg
- 개발 프로젝트: `money.public-api`
	- `money` 서비스 외부 연동 API 모듈

---

> feature/PREPAY-837-feat/20260203-01-requirement
> git stash pop

## 개발 범위

### 연계 통장 개설 프로세스
1. 머니 진입 세션 요청 API 개선 필요
	-  `/v1/session/{token}` API 수정
	1. `케이뱅크 계좌 개설 여부` , `오픈뱅킹 연동 여부` 응답 필요
		1. *JWT Token 기반으로 회원 정보 응답 처리*
		2. *`money` API 에서 JWT Token 을 생성해주면, 해당 토큰에서 각 여부값 확인하여 응답 처리*
3. 케이뱅크 가입 페이지 요청 API 신규 개발 필요
	1. 케이뱅크 가입 URL 요청 API 호출 `to kbank-outbound`
4. 케이뱅크 가입 완료 처리 API 신규 개발 필요
	1. 케이뱅크 가입 결과 caching 처리
	2. 케이뱅크 가입 완료 event publish
5. 오픈뱅킹 동의 완료 처리 API 신규 개발 필요
	1. 오픈뱅킹 동의 결과 caching 처리
	2. 오픈뱅킹 동의 완료 event publish

### 연계 통장 충전 프로세스
1. 잔액 요청 API 개선 필요
	- `/v1/summary` API 수정
	- [money API - /v2/balance](http://api.dev.in.musinsapayments.com/money/internal/swagger-ui/index.html#/Balance/balance) 연동 
	1. *제휴 통장 이용 여부 확인*
	2. *제휴 통장 이용하는 경우,* 
		1. *케이뱅크 잔액 조회 API 호출 `to kbank-outbound`*
		2. *케이뱅크 잔액 정보 응답 처리*
2. 케이뱅크 충전 요청 API 신규 개발 필요
	1. 케이뱅크 수납 이체 API 호출 `to kbank-outbound`
	2. 수납 이체 실패인 경우, 
		1. 수납 이체 실패 event publish
	3. 수납 이체 성공인 경우,
		1. 케이뱅크 지급 이체 API 호출 `to kbank-outbound`
		2. 지급 이체 성공인 경우,
			1. 케이뱅크 지급 이체 결과 caching 처리
			2. 충전 성공 event publish
		3. 지급 이체 실패인 경우,
			1. 지급 이체 실패 fallback event publish
			2. 지급 이체 실패 event publish

### 연계 통장 결제 프로세스
1. 사용 가능 금액 요청 API 개선 필요
	1. 제휴 통장 이용 여부 확인
	2. 제휴 통장 이용하는 경우, 
		1. 케이뱅크 잔액 조회 API 호출 `to kbank-outbound`
	3. 상품권, 포인트 잔액 조회
2. 케이뱅크 결제 요청 API 신규 개발 필요
	1. 케이뱅크 결제 요청 API 호출 `to money-api`

### 연계 통장 송금 프로세스
1. 사용 가능 금액 요청 API 개선 필요
	1. 제휴 통장 이용 여부 확인
	2. 제휴 통장 이용 중인 경우, 
		1. 케이뱅크 잔액 조회 API 호출 `to kbank-outbound`
	3. 상품권, 포인트 잔액 조회
2. 송금 세션 요청 API 신규 개발 필요
	1. 케이뱅크 예금주 검증 API 호출 `to kbank-outbound`
	2. 케이뱅크 예금주 검증 결과 caching 처리
3. 송금 승인 요청 API 신규 개발 필요
	1. 케이뱅크 송금-출금 요청 API 호출 `to kbank-outbound`
	2. 케이뱅크 송금-출금 요청 실패한 경우,
		1. 송금 실패 결과 event publish
	3. 케이뱅크 송금 요청 성공한 경우,
		1. 케이뱅크 송금-입금 요청 API 호출 `to kbank-outbound` 
		2. 케이뱅크 송금-입금 요청 성공인 경우,
			1. 송금 완료 event publish
		3. 케이뱅크 송금-입금 요청 실패인 경우,
			1. 송금 실패 event publish
			2. 송금 실패 fallback event publish
