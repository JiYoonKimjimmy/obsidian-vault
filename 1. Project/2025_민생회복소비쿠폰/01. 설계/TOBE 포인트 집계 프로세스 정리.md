### 포인트 거래 테스트 시나리오

- 각 거래 별 `TRAN_TYPE` 확인
- 카드 변경 거래 구분 확인
- 포인트 잔액 증감 확인

| 테스트 시나리오      | `TRAN_TYPE` | 결과  |
| ------------- | :---------: | --- |
| 지원금 지급        |  11<br>13   |     |
| 지원금 사용        |     02      |     |
| 지원금 환수        |  12<br>14   |     |
| 지원금 중지        |  12<br>14   |     |
| 카드 재발급(캐시 차감) |     05      |     |
| 카드 재발급(캐시 증가) |     06      |     |
| 무기명 카드 등록     |             |     |

#### ASIS 분석

- `TRAN_TYPE == 68: 캐시 모으기로 차감 & TRAN_TYPE == 05: 포인트 잔액 이관 소멸` 거래는 집계하지 않는가?
- `TRAN_TYPE == 67: 캐시 모으기로 적립 & TRAN_TYPE == 06: 포인트 잔액 이관 지급` 거래는 `amountRemain` 변경하지 않는가?
- 카드 재발급인 경우, `TRAN_TYPE` 거래 유형은?
	- INACTIVE 카드 포인트 차감 거래 : `TRAN_TYPE == 05`
		- `par`: 포인트 보내는 카드
	- ACTIVE 카드 포인트 증가 거래 : `TRAN_TYPE == 06`
		- `par`: 포인트 받는 카드
		- `trPar`: 포인트 보내는 카드
- 무기명 카드 등록인 경우, `TRAN_TYPE` 거래 유형은?

#### KPS `TRAN_TYPE` 구분

| 구분  | 설명                            |
| :-: | ----------------------------- |
| 01  | 일반 포인트적립                      |
| 02  | 일반 포인트 사용                     |
| 03  | 적립한도 초과                       |
| 04  | 인센티브로 적립된 포인트 소멸              |
| 05  | 포인트 이관에 의한 포인트 소멸             |
| 06  | 포인트 이관에 의한 포인트 잔액 이전          |
| 07  | 구매 적립                         |
| 08  | 포인트를 잔액으로 이관                  |
| 09  | 단말기를 이용한 카드 포인트적립             |
| 15  | 시스템 어드민 적립                    |
| 21  | 카드 연결 해제로 인한 소멸               |
| 22  | 캐시 송금 차감                      |
| 23  | 캐시 송금 적립                      |
| 24  | 타 카드캐시 이관으로 인한 포인트 차감         |
| 25  | 타 카드캐시 이관으로 인한 포인트 증가         |
| 31  | 유효기간 만료로 인한 소멸                |
| 41  | 회원탈퇴로 인한 소멸                   |
| 51  | 포인트 이용한 환급                    |
| 52  | 포인트 이요환급시 한도 초과에 의한 0point 지급 |
| 63  | 정액형 포인트 지급                    |
| 67  | 캐시 모으기로 적립                    |
| 68  | 캐시 모으기로 차감                    |
| 75  | 기부를 위한 포인트 사용                 |
| 91  | 적립 망취소                        |
| 92  | 사용 망취소                        |

#### 지원금 관련 포인트 거래 구분
* 02: 포인트 일반 사용 : par 기준 차감 거래
* 05: 포인트 이관 > 포인트 소멸 : par 기준 차감 거래
* 06: 포인트 이관 > 포인트 지급 : par 기준 적립 거래 (tr_par > par) => 카드 교체 처리 필요
* 11: 어드민 지급 : par 기준 적립 거래
* 31: 유효기간 만료 : par 기준 차감 거래
* 64: 공무원 회수 : par 기준 차감 거래
* 65: 어드민 벌크 적립 : par 기준 적립 거래
* 67: 캐시 모으기로 적립 : par 기준 적립 거래 (tr_par > par) => 카드 교체 처리 필요
* 68: 캐시 모으기로 차감 : par 기준 차감 거래

---

## 포인트 집계 개선안

1. 카드 교체는 CMS 카드 교체 Queue 메시지로만 처리
	- 카드 교체에 의한 포인트 이동 거래(tranType: 05, 06) 인 경우, `HOUSEHOLDER` 카드 변경 처리하지 않도록 변경
2. `HOUSEHOLDER_CARD_INFO` 대상자 카드 관리 DB 테이블 신규 생성
	- 컬럼 구성
		- `HOUSEHOLDER_ID`
		- `PAR` 
		- `PAR_OWNER_YN`: 해당 `PAR` 기준 마지막 소유한 대상자에게만 `Y` 저장
3. `HOUSEHOLDER_CARD_POINT` 대상자 카드 포인트 관리 DB 테이블 신규 생성
	- 해당 테이블은 좀 더 고민 필요
	- `HOUSEHOLDER_POINT_AGGREGATES` 테이블 활용 검토 필요